#!/usr/bin/env node

var path = require('path'),
	ucc = require('../lib/'),
	Source = require('./source'),
	Target = require('./target');

function main(argv) {
	var pkg = require(path.resolve('package.json')),
		source = pkg.source || 'src',
		target = pkg.target || 'build',
		
		prefix = (pkg.name || '') + '/' + (pkg.version || ''),
		
		compiler = ucc({
			modular: {
				alias: pkg.alias || {}
			}
		}),
	
	source = new Source(source);
	
	target = new Target(target);

	source.travel(function (pathname, data) {
		var id = path.join(prefix, pathname).replace(/\\/g, '/');

		data = compiler.compile(id, data).data;
		target.write(pathname, data);
	});
}

main(process.argv.slice(2));
