#!/usr/bin/env node

var path = require('path'),
	ucc = require('../lib/'),
	Source = require('./source'),
	Target = require('./target');

function main(argv) {
	var pkg = require(path.resolve('package.json'));

		pkg.source = pkg.source || 'src';
		pkg.target = pkg.target || 'build';

        pkg.alias = pkg.alias || {};
        pkg.dependencies = pkg.dependencies || {};

    var prefix = (pkg.name || '') + '/' + (pkg.version || ''),
        compiler = ucc(pkg),
	    source = new Source(pkg.source);
        target = new Target(pkg.target);

	source.travel(function (pathname, data) {
		var id = path.join(prefix, pathname).replace(/\\/g, '/');

		data = compiler.compile(id, data).data;
		target.write(pathname, data);
	});
}

main(process.argv.slice(2));
